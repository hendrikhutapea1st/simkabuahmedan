<template>
  <a
    :href="whatsappLink"
    target="_blank"
    rel="noopener noreferrer"
    :class="buttonClass"
    @click="trackClick"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      class="h-5 w-5 inline mr-2"
      viewBox="0 0 24 24"
      fill="currentColor"
    >
      <path d="M17.19 14.512c-.147-.177-.61-.333-1.108-.332-.078 0-.156.002-.234.005-.343.015-.677.048-1.003.097-.396.059-.776.144-1.142.253-.312.092-.614.196-.906.31-.232.092-.457.186-.675.281a7.782 7.782 0 0 0-2.78.077c-.308.074-.61.156-.906.247-.619.186-1.18.398-1.685.637-.514.243-.97.508-1.372.795-.206.146-.4.295-.583.447-.18.15-.32.29-.422.422-.177.224-.263.44-.258.65.005.258.133.483.303.64.118.112.26.18.42.203.16.024.33.003.495-.06a.5.5 0 0 1 .515.125c.157.156.334.293.53.41.197.117.41.213.637.288.455.152.946.23 1.46.234h.02c.166 0 .33-.006.492-.018.27-.02.536-.058.797-.113.13-.027.258-.06.384-.098.254-.076.5-.17.73-.28.23-.11.445-.235.645-.373.4-.278.74-.6.99-.96.125-.18.23-.372.31-.575.08-.204.13-.415.15-.63.02-.214-.145-.35-.31-.472z" />
      <path d="M20.995 4.5A4.49 4.49 0 0 0 17.137 2h-8.28a4.488 4.488 0 0 0-4.468 4.073l-.002.014c-.01.09-.01.18-.01.27v8.28c0 .19.01.38.03.57.014.13.03.26.05.39.02.13.04.26.07.39.03.13.06.26.1.38.04.13.08.25.13.38.05.12.1.25.16.37.06.12.12.24.19.36.07.12.14.23.22.35.08.12.16.23.25.34.09.11.18.22.27.33.09.11.19.21.29.31.1.1.2.2.31.29.11.09.22.18.34.26.12.08.24.15.36.22.12.07.25.13.38.19.13.06.26.11.39.16.13.05.26.09.39.13.13.04.26.07.39.1.13.03.26.05.39.07.13.02.26.04.39.05.13.01.26.02.39.02h.02c.13 0 .26-.01.39-.02.13-.01.26-.03.39-.05.13-.02.26-.04.39-.07.13-.03.26-.06.39-.1.13-.04.26-.08.39-.13.13-.05.26-.1.39-.16.12-.06.24-.13.36-.21.12-.08.24-.17.35-.26.11-.09.22-.19.33-.29.11-.1.21-.2.31-.31.1-.11.19-.23.27-.35.08-.12.15-.25.22-.38.07-.13.13-.27.18-.41.05-.14.09-.29.12-.44.03-.15.05-.3.06-.46.01-.16.02-.32.02-.48v-2.155c0-.14-.01-.28-.02-.42-.01-.14-.03-.28-.06-.42-.03-.14-.07-.28-.12-.42-.05-.14-.11-.27-.18-.4-.07-.13-.15-.26-.24-.38-.09-.12-.19-.24-.3-.35-.11-.11-.23-.21-.36-.31-.13-.1-.27-.19-.42-.27-.15-.08-.31-.15-.48-.21-.17-.06-.35-.11-.54-.15-.19-.04-.39-.07-.59-.08-.2-.01-.41-.02-.62-.02l-.25-.01h-.25c-.21 0-.42.01-.62.02-.2.01-.4.04-.59.08-.19.04-.37.09-.54.15-.17.06-.33.13-.48.21-.15.08-.29.17-.42.27-.13.1-.25.2-.36.31-.11.11-.21.23-.3.35-.09.12-.17.25-.24.38-.07.13-.13.26-.18.4-.05.14-.09.28-.12.42-.03.14-.05.28-.06.42-.01.14-.02.28-.02.42v.778c-.47-.22-.97-.38-1.5-.47l-.12-.02H4.5c-.28 0-.55.02-.81.05-.26.03-.52.08-.77.14-.25.06-.49.14-.72.23-.23.09-.45.2-.66.32-.21.12-.41.26-.59.41-.18.15-.35.32-.5.5-.15.18-.28.38-.39.59-.11.21-.2.44-.27.68-.07.24-.12.49-.15.75-.03.26-.05.53-.05.81v8.28c0 .29.02.56.05.82.03.26.08.51.15.75.07.24.16.47.27.68.11.21.24.41.39.59.15.18.32.35.5.5.18.15.38.29.6.41.22.12.45.22.69.3.24.08.49.15.75.2.26.05.53.08.81.08h8.28c.28 0 .55-.03.81-.08.26-.05.51-.12.75-.2.24-.08.47-.18.69-.3.22-.12.42-.26.6-.41.18-.15.34-.32.5-.5.15-.18.28-.38.39-.59.11-.21.2-.44.27-.68.07-.24.12-.49.15-.75.03-.26.05-.53.05-.81v-8.28c0-.28-.02-.55-.05-.81-.03-.26-.08-.51-.15-.75-.07-.24-.16-.47-.27-.68-.11-.21-.24-.41-.39-.59-.15-.18-.32-.35-.5-.5-.18-.15-.38-.29-.6-.41zm-5.355 9.905c-.03.04-.07.08-.12.11l-2.25 1.33c-.05.03-.11.05-.17.05-.06 0-.12-.02-.17-.05l-1.33-2.25c-.03-.05-.05-.11-.05-.17 0-.06.02-.12.05-.17l6.82-6.82c.05-.05.14-.05.19 0l1.67 1.67c.05.05.05.14 0 .19l-6.82 6.82c-.04.05-.1.07-.16.07-.06 0-.12-.02-.16-.06z" />
    </svg>
    {{ buttonText }}
  </a>
</template>

<script>
export default {
  name: 'WhatsAppButton',
  props: {
    phoneNumber: {
      type: String,
      default: '6281234567890' // Ganti dengan nomor telepon Anda
    },
    message: {
      type: String,
      default: 'Halo SIMKA Buah! Saya tertarik dengan buah segar Medan berkualitas. Mohon bantuannya untuk pesan buah segar terbaik yang tersedia saat ini.'
    },
    buttonText: {
      type: String,
      default: 'Pesan Via Admin 1'
    },
    buttonClass: {
      type: String,
      default: 'bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300 flex items-center'
    }
  },
  computed: {
    whatsappLink() {
      // Sanitize phone number - remove any non-digit characters except +
      const cleanedPhone = this.phoneNumber.replace(/[^0-9+]/g, '');
      
      // Validate phone number format - minimum 10 digits, maximum 15, starts with + or number
      if (!/^(\+?[1-9]\d{7,14})$/.test(cleanedPhone)) {
        console.warn('Invalid phone number format');
        return '#'; // Return safe fallback
      }
      
      // Sanitize message - encode special characters
      const sanitizedMessage = this.message
        .replace(/[\u0080-\uFFFF]/g, encodeURIComponent) // Encode non-ASCII
        .replace(/[<>'"&]/g, (match) => {
          // HTML entity encoding for security
          const entities = { '<': '%3C', '>': '%3E', '"': '%22', "'": '%27', '&': '%26' };
          return entities[match];
        });
      
      return `https://wa.me/${cleanedPhone}?text=${encodeURIComponent(sanitizedMessage)}`;
    }
  },
  methods: {
    trackClick() {
      // Fungsi untuk melacak klik (bisa diintegrasikan dengan analytics)
      console.log('WhatsApp button clicked');
    }
  }
}
</script>
